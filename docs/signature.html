<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>电子签名</title>
    <style>
      .g_btn {
        display: flex;
        height: 60px;
        justify-content: center;
        align-items: center;
      }
      .g_btn button {
        height: 32px;
        padding: 0 20px;
      }

      .g_btn #saveImage {
        margin-left: 20px;
        outline: 0 none;
        color: #fff;
        border: 0;
        padding: 3px 20px;
        border-radius: 3px;
        background-color: #1677ff;
        box-shadow: 0 2px 0 rgba(5, 145, 255, 0.1);
      }
    </style>
  </head>
  <body>
    <canvas id="myCanvas" style="border: 1px solid #d3d3d3">
      Your browser does not support the HTML5 canvas tag.
    </canvas>
    <div class="g_btn">
      <button id="clear">清空画布</button>
      <button id="saveImage">保存签名</button>
    </div>
    <script>
      let lastX = 0; let lastY = 0
      let width = document.body.clientWidth - 2;
      let height = (width / 9) * 6;
      const canvas = document.getElementById("myCanvas");
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext("2d");
      let painting = false;
      function startDraw(e) {
        painting = true;
        draw(e);
      }

      function endDraw() {
        painting = false;
        ctx.beginPath();
      }
      function touchend() {
        painting = false;
        ctx.beginPath();
      }
      function touchcancel() {
        painting = false;
      }

      function draw(e) {
        if (!painting) return;
        ctx.lineWidth = 5;
        ctx.lineCap = "round";
        ctx.strokeStyle = "black";
        lastY = e.clientY - offset.top;
        lastX = e.clientX - offset.left;
        ctx.lineTo(lastX, lastY);
        ctx.moveTo(lastX, lastY);
        ctx.stroke();
        ctx.beginPath();
        
      }
      function touchStart(e) {
        e.preventDefault();
        painting = true;
        draw(e.targetTouches[0]);
      }
      function touchmove(e) {
        e.preventDefault();
        draw(e.targetTouches[0]);
      }
      // pc
      canvas.addEventListener("mousedown", startDraw);
      canvas.addEventListener("mouseup", endDraw);
      canvas.addEventListener("mousemove", draw);
      // 移动
      canvas.addEventListener("touchstart", touchStart);
      canvas.addEventListener("touchmove", touchmove);
      canvas.addEventListener("touchend", touchend);
      canvas.addEventListener("touchcancel", touchcancel);
      document.getElementById("clear").addEventListener("click", () => {
        ctx.beginPath();
        ctx.clearRect(0, 0, width, height);
      });
      document.getElementById("saveImage").addEventListener("click", () => {
        // canvas.
        const images = canvas.toDataURL("image/png");
        const alink = document.createElement("a");
        alink.setAttribute("href", images);
        alink.setAttribute("download", Date.now() + ".png");
        document.body.appendChild(alink);
        alink.click();
        document.body.removeChild(alink);
      });
    </script>
  </body>
</html>
